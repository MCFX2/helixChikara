class PlayerShooting : ZilchComponent
{
  //keys
  [Property] var ShootKey : Keys = Keys.Space;
  [Property] var AnimeShipKey : Keys = Keys.One;
  [Property] var MachoCheeseShipKey : Keys = Keys.Two;
  [Property] var ReaganShipKey : Keys = Keys.Three;
  [Property] var ScoutShipKey : Keys = Keys.Four;
  
  //bullet physics
  [Property] var BulletSpawnOffset = Real2(1.5, 0); //Bullet creation position relative to ship X, Y
  [Property] var BulletSpeedAnime = 2.5;
  [Property] var BulletFireDelayAnime = 10; //number of logic ticks between reloads
  [Property] var BulletSpreadAnime = 0.05; //ratio of bullet spread. 0 = laser, 1 = 180 degree firing range
  
  
  var TimeSinceLastBullet = 0;
  var CurrentShip : Ship = Ship.Anime;
  
  var Rand : Random = Random();
    
  function Initialize(init : CogInitializer)
  {
    Zero.Connect(this.Space, Events.LogicUpdate, this.OnLogicUpdate);
  }
  
  function Shoot(){
    if(this.CurrentShip == Ship.Anime){
      if(this.TimeSinceLastBullet >= this.BulletFireDelayAnime){
        var currentBullet : Cog = this.Space.CreateAtPosition(Archetype.AnimeBullet, this.Owner.Transform.Translation + Real3(this.BulletSpawnOffset, 0));
        //Y=Speed^2 * sin(ang)
        var spreadAngle = this.Rand.Range(-90, 90) * this.BulletSpreadAnime;
        var velY = Math.Pow(this.BulletSpeedAnime, 2) * Math.Sin(Math.ToRadians(spreadAngle));
        var velX = Math.Pow(this.BulletSpeedAnime, 2) * Math.Cos(Math.ToRadians(spreadAngle));
        currentBullet.RigidBody.Velocity = Real3(velX, velY, 0);
        //Note that bullets are intentionally NOT made children of Screen, so if the level changes direction bullets don't follow. Realism!
        this.TimeSinceLastBullet = 0;
      }
    }
  }
  
  function ChangeShip(newShip : Ship){
    this.CurrentShip = newShip;
    //do other stuff we do when switching here
  }
  
  
  function CheckKeyboard() { //used for any key inputs that do NOT DIRECTLY affect acceleration
    if(Zero.Keyboard.KeyIsDown(this.ShootKey)){
      this.Shoot();
    }
    if(Zero.Keyboard.KeyIsDown(this.AnimeShipKey)){//TODO. make a single ship key and use WAD to select a ship to replace from a radial menu
      this.ChangeShip(Ship.Anime);
    }
    if(Zero.Keyboard.KeyIsDown(this.MachoCheeseShipKey)){
      this.ChangeShip(Ship.MachoCheese);
    }
    
  }

  function OnLogicUpdate(event : UpdateEvent)
  {
    this.CheckKeyboard();
    ++this.TimeSinceLastBullet;
  }
}
